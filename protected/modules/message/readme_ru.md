Yii Personal Messages
=====================

Модуль позволяет организовать в проекте систему личных сообщений.

Требования
----------
К yii проекту предъявляются следующие требования:

1. база данных на основе MySQL
2. идентификатор пользователя, используемый в проекте, имеет тип integer
3. наличие модели пользователя


Миграция с версии 0.2 к версии 0.3
----------------------------------
Чтобы изменить структуру таблицы сообщений с сохранением ее содержания, воспользуйтесь скриптом миграции migrations/m120321_222200_02_03.php в директории модуля. Если необходимо, отредактируйте свойства миграции:

1. $tablename - имя таблицы с сообщениями;
2. $createThreads - создать идентификаторы бесед при миграции. Установите в true, если вы хотите использовать организацию сообщений в виде "бесед"

Установка
---------

Для подключения модуля создайте в БД проекта таблицу со структурой, указанной в файле install.sql и отредактируйте конфигурацию вашего проекта:
~~~
[php]
'modules' => array(
    ...
    'pm' => array(
        'userClass' => 'User', //Класс, представляющий модель пользователя
	'getNameMethod' => 'getName', // имя метода для модели пользователя, возвращающего имя пользователя.
	'getUserIdExpression' => 'Yii::app()->user->id', // выражение, возвращающее id текущего пользователя в приложении.
	'tableName' => 'pm', // имя таблицы с персональными сообщениями
	'reallyDelete' => true, // удалять сообщения из базы
	'outgoingPageSize' => 10, // отправленных сообщений на страницу
	'incomingPageSize' => 10, // принятых сообщений на страницу
	'conversationMode' => true // использовать беседы при переписке
    )
)
~~~

При этом обязательны для указания 4 параметра:

1. `string userClass` - имя класса, используемого для модели пользователя. По умолчанию это `User`
2. `string getNameMethod` - имя поля в классе пользователя, которое отвечает за id пользователя. По умолчанию `id`
3. `int getUserIdExpression` - выражение, возвращающее id текущего пользователя в приложении
4.. `string tableName` - имя таблицы, установленной из файла install.sql, в которой будут храниться персональные сообщения.

Необязательные параметры:

1. `bool reallyDelete`. Сообщения в базе могут быть либо физически удалены при удалении их отправителем и получателем, либо только помечены как удаленные. Если параметр `reallyDelete` равен true, то сообщение удаляется из таблицы, как только его пометили на удаление как отправитель, так и получатель. В противном случае сообщение будет просто скрыто для отображения пользователю. По умолчанию равно `true`.
2. `outgoingPageSize`. Количество сообщений, выбираемых из базы при отображении страницы с исходящими сообщениями. По умолчанию 10.
3. `incomingPageSize`. Количество сообщений, выбираемых из базы при отображении страницы с входящими сообщениями. По умолчанию 10.
4. `conversationMode`. Если установлено в false, то сообщения отображаются под одному. Если установлено в true, сообщения между двумя пользователями будут сгруппированы в беседу, и показаны единой лентой (подобно тому как это сделано в facebook)
